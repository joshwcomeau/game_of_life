<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Game of Life</title>

<link rel="stylesheet" type="text/css" href="normalize.css">
<link rel="stylesheet" type="text/css" href="style.css">

<script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
<script src="http://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>

<script>
// Used to find out how many cells are alive
function countKeys(census) {
    var size = 0, key;
    for (key in obj) {
        if (obj.hasOwnProperty(key)) size++;
    }
    return size;
};

function drawBoard(numRows, numCols, cellSize) {
  var cells = [],
      currentCell;
  for (var row=0; row<numRows; row++) {
    var cellRow = [];
    for (var col=0; col<numCols; col++) {
      currentCell = "cell-"+row+"-"+col;
      cellRow.push(currentCell);
      $("#gameBoard").append("<div class='cell' id='" + currentCell + "'><div></div></div>")
    }
    cells.push(cellRow);
  }

  // Adjust our cell size to match our JS values
  $(".cell").css({
    width  : cellSize+"px",
    height : cellSize+"px"
  })

  return cells;
}

// Returns an array of arrays. The first sub-array is a list of ALIVE neighbors. The second sub-array is dead neighbors.
function getNeighbors(cell, census) {
  var cellCoords = cell.split("-"), // turns 'cell-2-14' into an array. FIrst value is a throwaway
      cellX = parseInt(cellCoords[1]),
      cellY = parseInt(cellCoords[2]),
      liveNeighbors,
      deadNeighbors;

  // Build cell array
  neighbors = [ 
    "cell-" + (cellX-1) + "-" + (cellY-1),
    "cell-" + (cellX-1) + "-" + (cellY  ),
    "cell-" + (cellX-1) + "-" + (cellY+1),
    "cell-" + (cellX  ) + "-" + (cellY-1),
    "cell-" + (cellX  ) + "-" + (cellY+1),
    "cell-" + (cellX+1) + "-" + (cellY-1),
    "cell-" + (cellX+1) + "-" + (cellY  ),
    "cell-" + (cellX+1) + "-" + (cellY+1),
  ]

  for ( var neighbor in neighborhood ) {
    if ( census.hasOwnProperty(neighborhood[neighbor]) ) {
      liveNeighbors.push(neighbor);
    } else {
      deadNeighbors.push(neighbor);
    }
  }

  return [ liveNeighbors, deadNeighbors ];

}

$(document).ready(function() {
  var cellSize = 15,
      boardWidth = $("#gameBoard").width(),
      boardHeight = $("#gameBoard").height(),
      numRows = Math.floor(boardHeight / cellSize),
      numCols = Math.floor(boardWidth / cellSize),
      census = {},              // A hash of all living cells.
      tickLength = 3000;        // Number of milliseconds per turn.

  // Draw our gameboard.
  cells = drawBoard(numRows, numCols, cellSize);

  // Add or remove cells by clicking.
  $(".cell > div").click(function() {
    var cellID = $(this).parent().attr("id");
    if ($(this).html() == '') {
      $(this).append("<div class='living'></div>");
      census[cellID] = true;
    } else {
      $(this).html("");
      delete census[cellID];
    }
  });

  ///////// GAME RULES
  // Any live cell with fewer than two live neighbours dies, as if caused by under-population.
  // Any live cell with two or three live neighbours lives on to the next generation.
  // Any live cell with more than three live neighbours dies, as if by overcrowding.
  // Any dead cell with exactly three live neighbours becomes a live cell, as if by reproduction.


  ///////// GAME LOOP
  setInterval(function(){
    // Create a working copy of our census.
    var newCensus = census;
    var deadCensus = {};


    var neighborNum;
    for( var cell in census ) {

      var neighborArray = getNeighbors(cell, census);
      var deadNeighbors = neighborArray[1],
          numOfAliveNeighbors = neighborArray[0].length;

      // Add dead neighbors to the neighbor object
      for (corpse in deadNeighbors) {
        console.log(corpse);
      }


      // 
      // console.log(cell);

      // neighborNum = getNumberOfNeighbors(cell, census);
    }

  },tickLength);
}); 
</script>  
<!--[if lt IE 9]>
<script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->
</head>

<body>
<div id="gameBoard"></div>
</body>
</html>